<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#000000">
    <title>Soulmate OS</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>

    <style>
        /* =========================================
           CORE STYLES
           ========================================= */
        :root {
            --bg-color: #050505;
            --app-header-height: 60px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'Inter', sans-serif;
            background: #000;
            color: #fff;
            height: 100dvh; /* Mobile Fit Fix */
            overflow: hidden;
            display: flex;
            justify-content: center;
            background-image: url('https://images.unsplash.com/photo-1618005182384-a83a8bd57fbe?q=80&w=1000&auto=format&fit=crop');
            background-size: cover; background-position: center;
        }

        .os-overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.7); backdrop-filter: blur(20px); }

        /* PHONE FRAME */
        .phone-frame {
            width: 100%; height: 100%; position: relative;
            background: #000; overflow: hidden;
            display: flex; flex-direction: column;
        }

        @media (min-width: 600px) {
            .phone-frame {
                width: 400px; height: 92vh; margin-top: 4vh;
                border-radius: 40px; border: 6px solid #222;
                box-shadow: 0 0 60px rgba(0,0,0,0.8);
            }
        }

        /* SCREENS */
        .screen {
            position: absolute; inset: 0;
            display: flex; flex-direction: column;
            background: #000;
            transition: transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
            transform: translateX(100%);
            z-index: 10;
        }
        .screen.active { transform: translateX(0); z-index: 20; }
        .screen.home { transform: translateX(0); z-index: 1; background: transparent; }

        /* HOME SCREEN */
        .home-header { padding: 50px 20px 10px; text-align: center; }
        .home-grid {
            padding: 20px;
            display: grid; grid-template-columns: repeat(3, 1fr);
            gap: 20px; align-content: start;
        }

        .app-icon { display: flex; flex-direction: column; align-items: center; gap: 8px; cursor: pointer; transition: 0.2s; }
        .app-icon:active { transform: scale(0.9); }

        .icon-box {
            width: 60px; height: 60px; border-radius: 16px;
            display: flex; align-items: center; justify-content: center;
            font-size: 24px; color: white;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.1);
        }
        .icon-label { font-size: 11px; font-weight: 500; text-shadow: 0 2px 4px rgba(0,0,0,0.8); }

        /* ICON GRADIENTS */
        .ico-chat { background: linear-gradient(135deg, #00c6ff, #0072ff); }
        .ico-music { background: linear-gradient(135deg, #8E2DE2, #4A00E0); }
        .ico-date { background: linear-gradient(135deg, #FF512F, #DD2476); }
        .ico-love { background: linear-gradient(135deg, #ff758c, #ff7eb3); }
        .ico-game { background: linear-gradient(135deg, #a8ff78, #78ffd6); color: #000; }
        .ico-diary { background: linear-gradient(135deg, #fce38a, #f38181); }
        .ico-age { background: linear-gradient(135deg, #43cea2, #185a9d); }
        .ico-mood { background: linear-gradient(135deg, #654ea3, #eaafc8); }
        .ico-magic { background: linear-gradient(135deg, #2b5876, #4e4376); }

        /* COMMON APP HEADER */
        .app-header {
            height: var(--app-header-height); padding: 0 15px;
            display: flex; align-items: center; gap: 15px;
            background: rgba(20,20,20,0.95); border-bottom: 1px solid #333;
        }
        .back-btn { font-size: 22px; cursor: pointer; padding: 5px; }
        .app-title { font-size: 18px; font-weight: 700; }

        /* --- APP STYLES --- */
        .app-content { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; overflow-y: auto; text-align: center; }

        /* 1. CHAT */
        .chat-feed { flex: 1; overflow-y: auto; padding: 15px; padding-bottom: 80px; display: flex; flex-direction: column; gap: 10px; width: 100%; }
        .msg-row { display: flex; width: 100%; }
        .msg-row.user { justify-content: flex-end; }
        .bubble { padding: 12px 16px; border-radius: 20px; max-width: 75%; font-size: 15px; word-wrap: break-word; }
        .ai-bubble { background: #222; color: #eee; border-bottom-left-radius: 4px; }
        .user-bubble { background: #0084ff; color: #fff; border-bottom-right-radius: 4px; }
        .chat-bar { position: absolute; bottom: 0; width: 100%; padding: 15px; background: #000; display: flex; gap: 10px; padding-bottom: max(15px, env(safe-area-inset-bottom)); border-top: 1px solid #222; }
        .chat-input { flex: 1; background: #222; border: none; padding: 12px 20px; border-radius: 30px; color: white; outline: none; }

        /* 2. AGE CALC */
        .age-input { padding: 15px; width: 100%; background: #222; border: 1px solid #444; border-radius: 12px; color: #fff; margin-bottom: 20px; }
        .age-result { font-size: 24px; font-weight: 700; color: #43cea2; margin-top: 20px; display: none; }
        .age-box { background: #111; padding: 20px; border-radius: 20px; width: 100%; border: 1px solid #333; }

        /* 3. MOOD SCANNER */
        .fingerprint { font-size: 80px; color: #444; margin: 30px 0; cursor: pointer; transition: 0.2s; position: relative; }
        .fingerprint.scanning { color: #ff4081; animation: pulse 0.5s infinite; }
        .scan-line { position: absolute; top: 0; left: 0; width: 100%; height: 2px; background: #00ff88; animation: scan 1s infinite; display: none; }
        .mood-result { font-size: 28px; font-weight: 800; margin-top: 20px; height: 40px; }
        @keyframes scan { 0% {top:0} 100% {top:100%} }
        @keyframes pulse { 0% {transform:scale(1)} 50% {transform:scale(1.1)} 100% {transform:scale(1)} }

        /* 4. MAGIC ORB */
        .magic-orb { width: 200px; height: 200px; border-radius: 50%; background: radial-gradient(circle at 30% 30%, #4e4376, #000); box-shadow: 0 0 50px rgba(78, 67, 118, 0.5); display: flex; align-items: center; justify-content: center; cursor: pointer; margin: 30px 0; transition: 0.3s; position: relative; overflow: hidden; }
        .magic-orb:active { transform: scale(0.95); }
        .magic-text { font-size: 24px; font-weight: 700; color: #fff; text-shadow: 0 0 10px #fff; z-index: 2; text-align: center; padding: 20px; }
        .orb-shine { position: absolute; top: 20%; left: 20%; width: 40px; height: 40px; background: rgba(255,255,255,0.2); border-radius: 50%; filter: blur(10px); }

        /* OTHERS */
        .music-art { width: 150px; height: 150px; border-radius: 20px; background-image: url('https://media.tenor.com/tHj10C6gX-IAAAAC/lofi-girl-lofi.gif'); background-size: cover; margin-bottom: 20px; }
        .game-btn { padding: 12px 30px; border-radius: 12px; font-weight: 700; border: none; cursor: pointer; width: 100%; margin: 5px 0; }
        .date-display { font-size: 50px; font-weight: 800; background: -webkit-linear-gradient(#eee, #333); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }

    </style>
    
    <script type="importmap">
      { "imports": { "@google/generative-ai": "https://esm.run/@google/generative-ai" } }
    </script>
</head>
<body>

    <div class="os-overlay"></div>

    <div class="phone-frame">
        
        <div class="screen home" id="homeScreen">
            <div class="home-header">
                <h1 style="font-size: 32px; font-weight: 800;">Soulmate OS</h1>
                <p style="opacity: 0.7; font-size: 13px;">v5.0 Ultra Edition</p>
            </div>

            <div class="home-grid">
                <div class="app-icon" onclick="openApp('appChat')">
                    <div class="icon-box ico-chat"><i class="fa-solid fa-comments"></i></div>
                    <span class="icon-label">Chat</span>
                </div>
                <div class="app-icon" onclick="openApp('appMusic')">
                    <div class="icon-box ico-music"><i class="fa-solid fa-music"></i></div>
                    <span class="icon-label">Music</span>
                </div>
                <div class="app-icon" onclick="openApp('appAge')">
                    <div class="icon-box ico-age"><i class="fa-solid fa-cake-candles"></i></div>
                    <span class="icon-label">Age Calc</span>
                </div>
                <div class="app-icon" onclick="openApp('appDate')">
                    <div class="icon-box ico-date"><i class="fa-solid fa-heart-pulse"></i></div>
                    <span class="icon-label">Together</span>
                </div>
                <div class="app-icon" onclick="openApp('appMood')">
                    <div class="icon-box ico-mood"><i class="fa-solid fa-fingerprint"></i></div>
                    <span class="icon-label">Mood Scan</span>
                </div>
                <div class="app-icon" onclick="openApp('appMagic')">
                    <div class="icon-box ico-magic"><i class="fa-solid fa-crystal-ball"></i></div>
                    <span class="icon-label">Decision</span>
                </div>
                <div class="app-icon" onclick="openApp('appLove')">
                    <div class="icon-box ico-love"><i class="fa-solid fa-calculator"></i></div>
                    <span class="icon-label">Love %</span>
                </div>
                <div class="app-icon" onclick="openApp('appGame')">
                    <div class="icon-box ico-game"><i class="fa-solid fa-dice"></i></div>
                    <span class="icon-label">Games</span>
                </div>
                <div class="app-icon" onclick="openApp('appDiary')">
                    <div class="icon-box ico-diary"><i class="fa-solid fa-book"></i></div>
                    <span class="icon-label">Diary</span>
                </div>
            </div>
        </div>

        <div class="screen" id="appChat">
            <div class="app-header">
                <i class="fa-solid fa-arrow-left back-btn" onclick="goHome()"></i>
                <div style="width:35px; height:35px; border-radius:50%; background:url('https://i.pinimg.com/736x/82/38/53/8238531eb4313264eb789b71e1fc2224.jpg'); background-size:cover;"></div>
                <span class="app-title">Khona</span>
            </div>
            <div class="chat-feed" id="chatFeed">
                <div class="msg-row"><div class="bubble ai-bubble">Hi Nihan! Kemon acho? ðŸ˜½</div></div>
            </div>
            <div class="chat-bar">
                <input type="text" class="chat-input" id="chatInput" placeholder="Message...">
                <button onclick="sendChat()" style="width:45px; height:45px; border-radius:50%; border:none; background:#0084ff; color:white;"><i class="fa-solid fa-paper-plane"></i></button>
            </div>
        </div>

        <div class="screen" id="appMusic">
            <div class="app-header"><i class="fa-solid fa-arrow-left back-btn" onclick="goHome()"></i><span class="app-title">Lofi Player</span></div>
            <div class="app-content">
                <div class="music-art"></div>
                <h3>Midnight Vibes</h3>
                <p style="color:#888; margin-bottom:30px;">Relaxing Beats</p>
                <div style="font-size:40px; cursor:pointer;" onclick="toggleMusic(this)">
                    <i class="fa-solid fa-circle-play" style="color:#8E2DE2"></i>
                </div>
                <audio id="audioPlayer" src="https://codeskulptor-demos.commondatastorage.googleapis.com/GalaxyInvaders/theme_01.mp3" loop></audio>
            </div>
        </div>

        <div class="screen" id="appAge">
            <div class="app-header"><i class="fa-solid fa-arrow-left back-btn" onclick="goHome()"></i><span class="app-title">Age Calculator</span></div>
            <div class="app-content">
                <div class="age-box">
                    <h3 style="margin-bottom:20px;">Enter Date of Birth</h3>
                    <input type="date" class="age-input" id="dobInput">
                    <button onclick="calculateAge()" class="game-btn" style="background:#43cea2; color:#000;">CALCULATE</button>
                    <div class="age-result" id="ageResult"></div>
                </div>
            </div>
        </div>

        <div class="screen" id="appDate">
            <div class="app-header"><i class="fa-solid fa-arrow-left back-btn" onclick="goHome()"></i><span class="app-title">Relationship</span></div>
            <div class="app-content">
                <i class="fa-solid fa-heart-pulse animate__animated animate__heartBeat animate__infinite" style="font-size:60px; color:#ff3366;"></i>
                <div class="date-display" id="daysCount" style="margin:20px 0;">0</div>
                <p>Days of Love</p>
                <input type="date" class="age-input" style="margin-top:30px;" id="startDate" onchange="calcDays()">
            </div>
        </div>

        <div class="screen" id="appMood">
            <div class="app-header"><i class="fa-solid fa-arrow-left back-btn" onclick="goHome()"></i><span class="app-title">Mood Scan</span></div>
            <div class="app-content">
                <p>Place finger to scan</p>
                <div class="fingerprint" id="fingerprint" onmousedown="startScan()" ontouchstart="startScan()" onmouseup="stopScan()" ontouchend="stopScan()">
                    <i class="fa-solid fa-fingerprint"></i>
                    <div class="scan-line" id="scanLine"></div>
                </div>
                <div class="mood-result" id="moodResult"></div>
            </div>
        </div>

        <div class="screen" id="appMagic">
            <div class="app-header"><i class="fa-solid fa-arrow-left back-btn" onclick="goHome()"></i><span class="app-title">Decision Orb</span></div>
            <div class="app-content">
                <p>Tap for an answer</p>
                <div class="magic-orb" onclick="askOrb()">
                    <div class="orb-shine"></div>
                    <div class="magic-text" id="orbText">?</div>
                </div>
            </div>
        </div>

        <div class="screen" id="appLove">
            <div class="app-header"><i class="fa-solid fa-arrow-left back-btn" onclick="goHome()"></i><span class="app-title">Love Calc</span></div>
            <div class="app-content">
                <input type="text" class="age-input" id="n1" placeholder="Name 1">
                <input type="text" class="age-input" id="n2" placeholder="Name 2">
                <button onclick="doLoveCalc()" class="game-btn" style="background:#ff758c; color:white;">CALCULATE</button>
                <h1 id="loveRes" style="margin-top:20px; font-size:40px;"></h1>
            </div>
        </div>

        <div class="screen" id="appGame">
            <div class="app-header"><i class="fa-solid fa-arrow-left back-btn" onclick="goHome()"></i><span class="app-title">Fun Games</span></div>
            <div class="app-content">
                <div class="age-box" style="margin-bottom:20px;">
                    <h3 id="tdText">Truth or Dare?</h3>
                </div>
                <button onclick="playTD('Truth')" class="game-btn" style="background:#00c6ff;">TRUTH</button>
                <button onclick="playTD('Dare')" class="game-btn" style="background:#ff4081; color:white;">DARE</button>
            </div>
        </div>

        <div class="screen" id="appDiary">
            <div class="app-header">
                <i class="fa-solid fa-arrow-left back-btn" onclick="goHome()"></i>
                <span class="app-title">Diary</span>
                <i class="fa-solid fa-save" onclick="saveDiary()" style="margin-left:auto; cursor:pointer;"></i>
            </div>
            <textarea style="width:100%; height:100%; background:#111; border:none; color:#fff; padding:20px; outline:none;" id="diaryText" placeholder="Dear Diary..."></textarea>
        </div>

    </div>

<script type="module">
    import { GoogleGenerativeAI } from "@google/generative-ai";

    // --- NAVIGATION ---
    window.openApp = (id) => {
        document.getElementById(id).classList.add('active');
        if(id === 'appDate') loadDate();
        if(id === 'appDiary') loadDiary();
    };
    window.goHome = () => {
        document.querySelectorAll('.screen').forEach(s => {
            if(!s.classList.contains('home')) s.classList.remove('active');
        });
    };

    // --- 1. CHAT ---
    const API_KEY = "AlzaSyCoxQEqblhAH4ZAmSHZljpJbqry7AdT6sY";
    let chatSession;
    try {
        const genAI = new GoogleGenerativeAI(API_KEY);
        const model = genAI.getGenerativeModel({ model: "gemini-1.5-flash" });
        chatSession = model.startChat({
             history: [{ role: "user", parts: [{ text: "You are Khona. Cute wife. Speak Banglish." }] }, { role: "model", parts: [{ text: "Meow! Ok." }] }]
        });
    } catch(e){}

    window.sendChat = async () => {
        const input = document.getElementById('chatInput');
        const text = input.value.trim();
        if(!text) return;
        addMsg(text, 'user');
        input.value = '';
        try {
            const result = await chatSession.sendMessage(text);
            addMsg(result.response.text(), 'ai');
        } catch(e) { addMsg("Connection Error ðŸ˜¿", 'ai'); }
    };

    function addMsg(text, sender) {
        const feed = document.getElementById('chatFeed');
        const div = document.createElement('div');
        div.className = `msg-row ${sender}`;
        div.innerHTML = `<div class="bubble ${sender === 'user' ? 'user-bubble' : 'ai-bubble'}">${text}</div>`;
        feed.appendChild(div);
        feed.scrollTop = feed.scrollHeight;
    }

    // --- 2. MUSIC ---
    window.toggleMusic = (btn) => {
        const audio = document.getElementById('audioPlayer');
        const icon = btn.querySelector('i');
        if (audio.paused) { audio.play(); icon.className = "fa-solid fa-circle-pause"; } 
        else { audio.pause(); icon.className = "fa-solid fa-circle-play"; }
    };

    // --- 3. AGE CALCULATOR (LOGIC) ---
    window.calculateAge = () => {
        const dobVal = document.getElementById('dobInput').value;
        if(!dobVal) return;
        const dob = new Date(dobVal);
        const now = new Date();
        let years = now.getFullYear() - dob.getFullYear();
        let months = now.getMonth() - dob.getMonth();
        let days = now.getDate() - dob.getDate();

        if (months < 0 || (months === 0 && days < 0)) { years--; months += 12; }
        if (days < 0) {
            const prevMonth = new Date(now.getFullYear(), now.getMonth(), 0);
            days += prevMonth.getDate();
            months--;
        }
        
        const res = document.getElementById('ageResult');
        res.innerHTML = `${years}Y ${months}M ${days}D`;
        res.style.display = 'block';
    };

    // --- 4. MOOD SCANNER (LOGIC) ---
    let scanTimer;
    const MOODS = ["Horny ðŸ˜ˆ", "Romantic â¤ï¸", "Angry ðŸ˜ ", "Hungry ðŸ”", "Naughty ðŸ˜œ", "Sleepy ðŸ˜´"];
    
    window.startScan = () => {
        document.getElementById('fingerprint').classList.add('scanning');
        document.getElementById('scanLine').style.display = 'block';
        document.getElementById('moodResult').innerText = "Scanning...";
        scanTimer = setTimeout(() => {
            const mood = MOODS[Math.floor(Math.random() * MOODS.length)];
            document.getElementById('moodResult').innerText = mood;
            stopScan();
        }, 2000);
    };
    
    window.stopScan = () => {
        clearTimeout(scanTimer);
        document.getElementById('fingerprint').classList.remove('scanning');
        document.getElementById('scanLine').style.display = 'none';
    };

    // --- 5. MAGIC ORB (LOGIC) ---
    const ANSWERS = ["Yes", "No", "Maybe", "Ask Khona", "Definetly", "Never"];
    window.askOrb = () => {
        const txt = document.getElementById('orbText');
        txt.innerText = "...";
        setTimeout(() => {
            txt.innerText = ANSWERS[Math.floor(Math.random() * ANSWERS.length)];
        }, 500);
    };

    // --- 6. OTHERS (Date, Love, Game, Diary) ---
    window.calcDays = () => {
        const s = document.getElementById('startDate').value;
        if(s) {
            localStorage.setItem('sm_date', s);
            const d = Math.ceil(Math.abs(new Date() - new Date(s)) / (86400000));
            document.getElementById('daysCount').innerText = d;
        }
    };
    window.loadDate = () => { const s = localStorage.getItem('sm_date'); if(s) { document.getElementById('startDate').value = s; calcDays(); } };
    
    window.doLoveCalc = () => {
        if(document.getElementById('n1').value && document.getElementById('n2').value)
            document.getElementById('loveRes').innerText = (Math.floor(Math.random()*20)+80) + "%";
    };

    window.playTD = (type) => {
        const t = type==='Truth'?["Secret?","Crush?"]:["Dance!","Selfie!"];
        document.getElementById('tdText').innerText = t[Math.floor(Math.random()*t.length)];
    };

    window.saveDiary = () => { localStorage.setItem('sm_diary', document.getElementById('diaryText').value); alert("Saved!"); };
    window.loadDiary = () => { const t = localStorage.getItem('sm_diary'); if(t) document.getElementById('diaryText').value = t; };

</script>
</body>
</html>
