<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nihan Programming - Advanced Ant System</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: #f0f0f0;
            font-family: 'Courier New', Courier, monospace;
        }
        canvas {
            display: block;
        }
        /* UI Control Panel */
        #controls {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.9);
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            border-left: 5px solid #362312;
            user-select: none;
        }
        .control-group {
            margin-bottom: 10px;
        }
        label {
            display: block;
            font-size: 14px;
            font-weight: bold;
            color: #333;
        }
        input[type=range] {
            width: 150px;
        }
        .status {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
    </style>
</head>
<body>

<div id="controls">
    <h3>NIHAN SYSTEM</h3>
    <div class="control-group">
        <label>Colony Size: <span id="countVal">100</span></label>
        <input type="range" id="antRange" min="20" max="300" value="100">
    </div>
    <div class="control-group">
        <label>Speed Factor</label>
        <input type="range" id="speedRange" min="1" max="5" step="0.1" value="2">
    </div>
    <div class="status">
        Interaction: Mouse Move (Attract)<br>
        Defense: Click (Scatter)
    </div>
</div>

<canvas id="antCanvas"></canvas>

<script>
    const canvas = document.getElementById('antCanvas');
    const ctx = canvas.getContext('2d');

    let width, height;
    
    // Mouse Interaction Object
    const mouse = { x: -1000, y: -1000, active: false };

    // System Variables
    let ants = [];
    let antCount = 100;
    let globalSpeed = 2;
    let panicMode = false;

    // Resize Handler
    function resize() {
        width = window.innerWidth;
        height = window.innerHeight;
        canvas.width = width;
        canvas.height = height;
    }
    window.addEventListener('resize', resize);
    resize();

    // Mouse Listeners
    window.addEventListener('mousemove', (e) => {
        mouse.x = e.clientX;
        mouse.y = e.clientY;
        mouse.active = true;
    });

    window.addEventListener('mousedown', () => {
        panicMode = true;
        setTimeout(() => { panicMode = false; }, 800); // Panic lasts 0.8 seconds
    });

    // UI Listeners
    const antRange = document.getElementById('antRange');
    const speedRange = document.getElementById('speedRange');
    const countVal = document.getElementById('countVal');

    antRange.addEventListener('input', (e) => {
        antCount = parseInt(e.target.value);
        countVal.innerText = antCount;
        initAnts();
    });

    speedRange.addEventListener('input', (e) => {
        globalSpeed = parseFloat(e.target.value);
    });

    // --- The Advanced Ant Class ---
    class Ant {
        constructor() {
            this.reset();
        }

        reset() {
            this.x = Math.random() * width;
            this.y = Math.random() * height;
            this.angle = Math.random() * Math.PI * 2;
            this.size = Math.random() * 0.4 + 0.6; // Scale
            this.baseSpeed = Math.random() * 0.5 + 0.5;
            this.walkCycle = Math.random() * 10; // For leg animation
            this.turnSpeed = 0.1;
        }

        update() {
            let targetAngle = this.angle;
            let speedMultiplier = 1;

            // 1. Interaction Logic (Mouse)
            if (mouse.active) {
                const dx = mouse.x - this.x;
                const dy = mouse.y - this.y;
                const dist = Math.sqrt(dx*dx + dy*dy);

                if (panicMode && dist < 300) {
                    // SCATTER: Run away from mouse
                    targetAngle = Math.atan2(dy, dx) + Math.PI; // Opposite direction
                    speedMultiplier = 4; // Run fast
                    this.turnSpeed = 0.5;
                } 
                else if (dist < 400 && !panicMode) {
                    // ATTRACT: Swarm towards mouse (with some randomness)
                    targetAngle = Math.atan2(dy, dx);
                    speedMultiplier = 1.5;
                    this.turnSpeed = 0.15;
                }
            }

            // 2. Smooth Steering (Turn towards target)
            // Determine the shortest rotation direction
            let diff = targetAngle - this.angle;
            while (diff < -Math.PI) diff += Math.PI * 2;
            while (diff > Math.PI) diff -= Math.PI * 2;
            
            // Add randomness (Ants are jittery)
            diff += (Math.random() - 0.5) * 0.5; 

            this.angle += diff * this.turnSpeed;

            // 3. Move
            const currentSpeed = this.baseSpeed * globalSpeed * speedMultiplier;
            this.x += Math.cos(this.angle) * currentSpeed;
            this.y += Math.sin(this.angle) * currentSpeed;

            // 4. Update Walk Cycle (Leg animation speed depends on movement speed)
            this.walkCycle += currentSpeed * 0.5;

            // 5. Screen Wrapping
            if (this.x < -20) this.x = width + 20;
            if (this.x > width + 20) this.x = -20;
            if (this.y < -20) this.y = height + 20;
            if (this.y > height + 20) this.y = -20;
        }

        draw() {
            ctx.save();
            ctx.translate(this.x, this.y);
            ctx.rotate(this.angle);

            const s = this.size;
            ctx.fillStyle = "#362312";
            ctx.strokeStyle = "#362312";
            ctx.lineWidth = 0.5;
            ctx.lineCap = "round";

            // --- Animated Legs ---
            // We use sin/cos of walkCycle to oscillate legs
            const legOffset = Math.sin(this.walkCycle) * 0.2; 
            const legOffset2 = Math.cos(this.walkCycle) * 0.2; 

            const legLen = 4 * s;

            // Leg Group 1 (Front-Right, Mid-Left, Back-Right)
            this.drawLeg(1.5*s, 2*s, legLen, -0.5 + legOffset);  // Front R
            this.drawLeg(-0.5*s, -2*s, legLen, 0 + legOffset);   // Mid L
            this.drawLeg(-2.5*s, 2*s, legLen, 0.5 + legOffset);  // Back R

            // Leg Group 2 (Front-Left, Mid-Right, Back-Left)
            this.drawLeg(1.5*s, -2*s, legLen, -0.5 + legOffset2); // Front L
            this.drawLeg(-0.5*s, 2*s, legLen, 0 + legOffset2);    // Mid R
            this.drawLeg(-2.5*s, -2*s, legLen, 0.5 + legOffset2); // Back L

            // --- Body Segments ---
            ctx.beginPath();
            ctx.arc(1.5 * s, 0, 0.9 * s, 0, Math.PI * 2); // Head
            ctx.arc(-0.5 * s, 0, 0.8 * s, 0, Math.PI * 2); // Thorax
            ctx.ellipse(-3 * s, 0, 1.8 * s, 1.3 * s, 0, 0, Math.PI * 2); // Abdomen
            ctx.fill();

            // Antennae
            ctx.beginPath();
            ctx.moveTo(2*s, 0.5*s); ctx.lineTo(4*s, 2*s);
            ctx.moveTo(2*s, -0.5*s); ctx.lineTo(4*s, -2*s);
            ctx.stroke();

            ctx.restore();
        }

        drawLeg(x, y, len, angleOffset) {
            // Helper to draw a jointed leg
            ctx.beginPath();
            ctx.moveTo(x, 0);
            
            // Knee position
            const kneeX = x + (y > 0 ? 2 : 2); 
            const kneeY = y;
            
            ctx.lineTo(kneeX, kneeY);
            
            // Foot position (Adding movement)
            const footX = kneeX + len * Math.cos(angleOffset);
            const footY = kneeY + len * Math.sin(Math.PI/2 + angleOffset * (y>0?1:-1));
            
            ctx.lineTo(footX, footY);
            ctx.stroke();
        }
    }

    // --- Initialization & Loop ---
    function initAnts() {
        ants = [];
        for (let i = 0; i < antCount; i++) {
            ants.push(new Ant());
        }
    }

    function drawWatermark() {
        ctx.save();
        ctx.translate(width / 2, height / 2);
        ctx.font = "900 70px Courier New";
        ctx.fillStyle = "rgba(0, 0, 0, 0.04)"; 
        ctx.textAlign = "center";
        ctx.textBaseline = "middle";
        ctx.fillText("NIHAN PROGRAMMING", 0, 0);
        
        ctx.font = "14px Courier New";
        ctx.fillText("ADVANCED SIMULATION v2.0", 0, 50);
        ctx.restore();
    }

    function animate() {
        ctx.clearRect(0, 0, width, height);
        
        drawWatermark();

        ants.forEach(ant => {
            ant.update();
            ant.draw();
        });

        requestAnimationFrame(animate);
    }

    initAnts();
    animate();

</script>

</body>
</html>
