<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#000000">
    <title>Soulmate OS v6</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>

    <style>
        /* =========================================
           1. MODERN VARS & CORE
           ========================================= */
        :root {
            --bg-dark: #050505;
            --glass: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.1);
            --neon-blue: #00f2fe;
            --neon-pink: #fe0069;
            --font-main: 'Outfit', sans-serif;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: var(--font-main);
            background: #000;
            color: #fff;
            height: 100dvh;
            overflow: hidden;
            display: flex; justify-content: center;
            /* Animated Background */
            background: radial-gradient(circle at 50% 10%, #1a1a2e, #000);
        }

        /* BACKGROUND PARTICLES */
        .stars { position: absolute; top:0; left:0; width:100%; height:100%; pointer-events:none; background-image: radial-gradient(white 1px, transparent 1px); background-size: 50px 50px; opacity: 0.1; }

        /* PHONE FRAME */
        .os-frame {
            width: 100%; height: 100%; position: relative;
            background: rgba(0,0,0,0.2);
            backdrop-filter: blur(20px);
            overflow: hidden; display: flex; flex-direction: column;
        }

        @media (min-width: 600px) {
            .os-frame {
                width: 400px; height: 92vh; margin-top: 4vh;
                border-radius: 45px; border: 4px solid #333;
                box-shadow: 0 0 80px rgba(0,242,254,0.1);
            }
        }

        /* =========================================
           2. SCREENS & ANIMATIONS
           ========================================= */
        .screen {
            position: absolute; inset: 0;
            display: flex; flex-direction: column;
            background: #000;
            opacity: 0; pointer-events: none; transform: scale(0.9);
            transition: 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            z-index: 10;
        }
        
        .screen.active { opacity: 1; pointer-events: auto; transform: scale(1); z-index: 20; }
        .screen.home { opacity: 1; pointer-events: auto; transform: scale(1); z-index: 1; background: transparent; }

        /* HOME UI */
        .home-header { padding: 50px 20px 20px; text-align: center; }
        .home-grid {
            padding: 20px; display: grid; grid-template-columns: repeat(3, 1fr);
            gap: 25px; align-content: start;
        }

        .app-icon {
            display: flex; flex-direction: column; align-items: center; gap: 10px;
            cursor: pointer; transition: 0.3s; animation: float 6s ease-in-out infinite;
        }
        .app-icon:nth-child(even) { animation-delay: 1s; }
        .app-icon:active { transform: scale(0.85); }

        .icon-box {
            width: 68px; height: 68px; border-radius: 22px;
            display: flex; align-items: center; justify-content: center;
            font-size: 28px; color: white;
            box-shadow: 0 10px 25px rgba(0,0,0,0.5);
            background: rgba(255,255,255,0.08);
            border: 1px solid rgba(255,255,255,0.15);
            backdrop-filter: blur(10px);
        }
        
        @keyframes float { 0%, 100% {transform: translateY(0);} 50% {transform: translateY(-8px);} }

        /* APP HEADER */
        .app-header {
            height: 70px; padding: 0 20px;
            display: flex; align-items: center; justify-content: space-between;
            background: rgba(20,20,20,0.8); backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--glass-border);
            z-index: 50;
        }
        .back-btn { width: 40px; height: 40px; border-radius: 50%; background: var(--glass); display: flex; align-items: center; justify-content: center; cursor: pointer; }

        /* =========================================
           3. APP SPECIFIC UI
           ========================================= */
        
        /* CHAT */
        .chat-feed { flex: 1; overflow-y: auto; padding: 20px; padding-bottom: 100px; display: flex; flex-direction: column; gap: 12px; }
        .msg { max-width: 80%; padding: 14px 18px; border-radius: 24px; font-size: 15px; line-height: 1.5; animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .msg.ai { background: #1a1a1a; color: #eee; border-bottom-left-radius: 4px; border: 1px solid #333; }
        .msg.user { background: linear-gradient(135deg, #00c6ff, #0072ff); align-self: flex-end; border-bottom-right-radius: 4px; box-shadow: 0 5px 15px rgba(0,198,255,0.3); }
        .chat-bar { position: absolute; bottom: 0; width: 100%; padding: 15px; background: rgba(0,0,0,0.9); display: flex; gap: 10px; padding-bottom: max(20px, env(safe-area-inset-bottom)); }
        .chat-input { flex: 1; background: #222; border: 1px solid #333; padding: 12px 20px; border-radius: 30px; color: white; outline: none; transition: 0.3s; }
        .chat-input:focus { border-color: var(--neon-blue); box-shadow: 0 0 15px rgba(0,242,254,0.1); }
        @keyframes popIn { from {opacity:0; transform: scale(0.8) translateY(20px);} to {opacity:1; transform: scale(1) translateY(0);} }

        /* TOGETHER (Custom Date) */
        .together-container { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; padding: 20px; background: radial-gradient(circle at center, #220a15, #000); }
        .heart-beat { font-size: 80px; color: #ff0055; animation: heartbeat 1.2s infinite; filter: drop-shadow(0 0 20px rgba(255,0,85,0.6)); margin-bottom: 20px; }
        .days-big { font-size: 70px; font-weight: 800; background: linear-gradient(to bottom, #fff, #aaa); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        
        /* Custom Date Picker UI */
        .date-picker-ui { display: flex; gap: 10px; margin-top: 30px; }
        .date-box { width: 70px; height: 60px; background: #222; border: 1px solid #444; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 20px; font-weight: 700; color: #fff; text-align: center; outline: none; transition: 0.3s; }
        .date-box:focus { border-color: #ff0055; background: #330a15; }
        @keyframes heartbeat { 0% {transform: scale(1);} 15% {transform: scale(1.15);} 30% {transform: scale(1);} 45% {transform: scale(1.15);} 60% {transform: scale(1);} }

        /* TRUTH OR DARE */
        .game-card { width: 100%; padding: 40px 20px; background: rgba(255,255,255,0.05); border-radius: 30px; border: 1px solid rgba(255,255,255,0.1); margin-bottom: 30px; min-height: 250px; display: flex; align-items: center; justify-content: center; text-align: center; font-size: 20px; font-weight: 600; line-height: 1.6; box-shadow: 0 10px 40px rgba(0,0,0,0.5); }
        .btn-row { display: flex; gap: 20px; width: 100%; }
        .gm-btn { flex: 1; padding: 15px; border-radius: 15px; border: none; font-weight: 700; font-size: 16px; cursor: pointer; transition: 0.2s; }
        .btn-truth { background: linear-gradient(135deg, #4facfe, #00f2fe); color: #000; }
        .btn-dare { background: linear-gradient(135deg, #ff0844, #ffb199); color: #fff; }
        .gm-btn:active { transform: scale(0.95); }

        /* MUSIC */
        .music-disc { width: 220px; height: 220px; border-radius: 50%; background: url('https://i.pinimg.com/originals/2b/96/1a/2b961a9c4021237a85d2634e568b2006.gif'); background-size: cover; box-shadow: 0 0 50px rgba(130, 0, 255, 0.4); animation: spin 10s linear infinite; animation-play-state: paused; margin: 40px auto; border: 4px solid #333; }
        .playing .music-disc { animation-play-state: running; border-color: #aa00ff; }
        @keyframes spin { 100% {transform: rotate(360deg);} }

    </style>
    
    <script type="importmap">
      { "imports": { "@google/generative-ai": "https://esm.run/@google/generative-ai" } }
    </script>
</head>
<body>

    <div class="stars"></div>

    <div class="os-frame">
        
        <div class="screen home active" id="homeScreen">
            <div class="home-header">
                <h1 style="font-size: 36px; font-weight: 800; letter-spacing: -1px;">Soulmate OS</h1>
                <p style="color:#888; font-size: 14px; margin-top:5px;">Future Edition v6.0</p>
            </div>

            <div class="home-grid">
                <div class="app-icon" onclick="openApp('appChat')">
                    <div class="icon-box" style="background: linear-gradient(135deg, #00c6ff, #0072ff);"><i class="fa-solid fa-comments"></i></div>
                    <span>Chat</span>
                </div>
                <div class="app-icon" onclick="openApp('appTogether')">
                    <div class="icon-box" style="background: linear-gradient(135deg, #ff0844, #ffb199);"><i class="fa-solid fa-heart-pulse"></i></div>
                    <span>Together</span>
                </div>
                <div class="app-icon" onclick="openApp('appGame')">
                    <div class="icon-box" style="background: linear-gradient(135deg, #f093fb, #f5576c);"><i class="fa-solid fa-gamepad"></i></div>
                    <span>Games</span>
                </div>
                <div class="app-icon" onclick="openApp('appMusic')">
                    <div class="icon-box" style="background: linear-gradient(135deg, #8E2DE2, #4A00E0);"><i class="fa-solid fa-music"></i></div>
                    <span>Music</span>
                </div>
                <div class="app-icon" onclick="openApp('appDecision')">
                    <div class="icon-box" style="background: linear-gradient(135deg, #43e97b, #38f9d7); color:#000;"><i class="fa-solid fa-bolt"></i></div>
                    <span>Decision</span>
                </div>
                <div class="app-icon" onclick="openApp('appMood')">
                    <div class="icon-box" style="background: linear-gradient(135deg, #fa709a, #fee140);"><i class="fa-solid fa-fingerprint"></i></div>
                    <span>Mood</span>
                </div>
            </div>
        </div>

        <div class="screen" id="appChat">
            <div class="app-header">
                <div class="back-btn" onclick="goHome()"><i class="fa-solid fa-chevron-left"></i></div>
                <h3 style="font-size:18px;">Khona AI</h3>
                <div style="width:35px; height:35px; border-radius:50%; background:url('https://i.pinimg.com/736x/82/38/53/8238531eb4313264eb789b71e1fc2224.jpg') center/cover;"></div>
            </div>
            <div class="chat-feed" id="chatFeed">
                <div class="msg ai">Hi Jan! Kemon acho tumi? ðŸ˜½</div>
            </div>
            <div class="chat-bar">
                <input type="text" class="chat-input" id="chatInput" placeholder="Type something...">
                <button onclick="sendChat()" style="width:45px; height:45px; border-radius:50%; border:none; background:#00c6ff; color:white; font-size:18px;"><i class="fa-solid fa-paper-plane"></i></button>
            </div>
        </div>

        <div class="screen" id="appTogether">
            <div class="app-header"><div class="back-btn" onclick="goHome()"><i class="fa-solid fa-chevron-left"></i></div><span>Love Counter</span><div></div></div>
            <div class="together-container">
                <i class="fa-solid fa-heart heart-beat"></i>
                <div class="days-big" id="daysCount">0</div>
                <p style="color:#aaa; letter-spacing: 2px; margin-bottom: 40px;">DAYS IN LOVE</p>
                
                <p style="font-size:12px; color:#666;">SET START DATE (DD / MM / YYYY)</p>
                <div class="date-picker-ui">
                    <input type="number" id="inDay" class="date-box" placeholder="DD" max="31">
                    <input type="number" id="inMonth" class="date-box" placeholder="MM" max="12">
                    <input type="number" id="inYear" class="date-box" placeholder="YYYY" style="width:90px;">
                </div>
                <button onclick="saveDate()" style="margin-top:20px; padding:10px 30px; background:#ff0055; color:white; border:none; border-radius:20px; font-weight:700;">UPDATE</button>
            </div>
        </div>

        <div class="screen" id="appGame">
            <div class="app-header"><div class="back-btn" onclick="goHome()"><i class="fa-solid fa-chevron-left"></i></div><span>Truth or Dare</span><div></div></div>
            <div style="flex:1; padding:30px; display:flex; flex-direction:column; justify-content:center;">
                <div class="game-card animate__animated" id="gameCard">
                    Tap a button to start the game!
                </div>
                <div class="btn-row">
                    <button class="gm-btn btn-truth" onclick="playGame('Truth')">TRUTH</button>
                    <button class="gm-btn btn-dare" onclick="playGame('Dare')">DARE</button>
                </div>
            </div>
        </div>

        <div class="screen" id="appMusic">
            <div class="app-header"><div class="back-btn" onclick="goHome()"><i class="fa-solid fa-chevron-left"></i></div><span>Vibe Player</span><div></div></div>
            <div style="flex:1; display:flex; flex-direction:column; align-items:center; justify-content:center; background: radial-gradient(circle, #2a0845, #000);">
                <div class="music-disc" id="musicDisc"></div>
                <h2 style="margin-top:20px;">Lofi Nights</h2>
                <p style="color:#aaa; font-size:14px;">Chill Beats</p>
                <div style="font-size:50px; margin-top:30px; cursor:pointer; color:#aa00ff;" onclick="toggleMusic(this)">
                    <i class="fa-solid fa-circle-play"></i>
                </div>
                <audio id="audioPlayer" src="https://codeskulptor-demos.commondatastorage.googleapis.com/GalaxyInvaders/theme_01.mp3" loop></audio>
            </div>
        </div>

        <div class="screen" id="appDecision">
            <div class="app-header"><div class="back-btn" onclick="goHome()"><i class="fa-solid fa-chevron-left"></i></div><span>Magic Orb</span><div></div></div>
            <div style="flex:1; display:flex; align-items:center; justify-content:center; flex-direction:column;">
                <div style="width:200px; height:200px; border-radius:50%; background:radial-gradient(circle at 30% 30%, #38f9d7, #000); box-shadow:0 0 60px rgba(56,249,215,0.4); display:flex; align-items:center; justify-content:center; font-size:24px; font-weight:800; cursor:pointer;" onclick="askOrb(this)">
                    TAP ME
                </div>
            </div>
        </div>

        <div class="screen" id="appMood">
            <div class="app-header"><div class="back-btn" onclick="goHome()"><i class="fa-solid fa-chevron-left"></i></div><span>Mood Scan</span><div></div></div>
            <div style="flex:1; display:flex; align-items:center; justify-content:center; flex-direction:column;">
                <i class="fa-solid fa-fingerprint" style="font-size:100px; color:#444; transition:0.3s;" id="finger" onmousedown="scanMood()" onmouseup="stopScan()" ontouchstart="scanMood()" ontouchend="stopScan()"></i>
                <h2 id="moodTxt" style="margin-top:40px; height:40px;">Hold to Scan</h2>
            </div>
        </div>

    </div>

<script type="module">
    import { GoogleGenerativeAI } from "https://esm.run/@google/generative-ai";

    // --- NAVIGATION ---
    window.openApp = (id) => {
        document.getElementById('homeScreen').classList.remove('active');
        document.getElementById(id).classList.add('active');
        if(id === 'appTogether') loadDate();
    };
    window.goHome = () => {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById('homeScreen').classList.add('active');
    };

    // --- 1. CHAT (GEMINI) ---
    const API_KEY = "AlzaSyCoxQEqblhAH4ZAmSHZljpJbqry7AdT6sY";
    let chatSession;
    try {
        const genAI = new GoogleGenerativeAI(API_KEY);
        const model = genAI.getGenerativeModel({ model: "gemini-1.5-flash" });
        chatSession = model.startChat({
             history: [{ role: "user", parts: [{ text: "You are Khona. Cute cat wife. Speak Banglish." }] }, { role: "model", parts: [{ text: "Meow! Ok." }] }]
        });
    } catch(e){}

    window.sendChat = async () => {
        const input = document.getElementById('chatInput');
        const text = input.value.trim();
        if(!text) return;
        addMsg(text, 'user');
        input.value = '';
        try {
            const result = await chatSession.sendMessage(text);
            addMsg(result.response.text(), 'ai');
        } catch(e) { addMsg("Net problem ðŸ˜¿", 'ai'); }
    };

    function addMsg(text, sender) {
        const feed = document.getElementById('chatFeed');
        const div = document.createElement('div');
        div.className = `msg ${sender}`;
        div.innerHTML = text;
        feed.appendChild(div);
        feed.scrollTop = feed.scrollHeight;
    }

    // --- 2.
